<!DOCTYPE html><html><head><head> <!-- Include Meta Tags Here --><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="viewport" content="width=device-width, height=device-height, initial-scale=1 user-scalable=no, shrink-to-fit=no"><meta content='#000000' name='theme-color'/><meta name="keywords" content="Blog, CCIE, Cisco, Wireshark, PCAP, Suricata, Bro, Zeek"><title>Failing Forward | Docker on WSL2</title><!-- Open Graph general (Facebook, Pinterest & Google+) --><meta name="og:title" content="Failing Forward | Docker on WSL2"><meta name="og:description" content="How to run docker on Win10 using WSL2 and troubleshooting common problems."><meta name="og:image" content="/assets/images/docker-wsl2.jpg"><meta name="og:image:alt" content="Failing Forward | Docker on WSL2"><meta name="og:url" content="https://blog.showipintbri.com/blog/docker-wsl2"><meta name="article:author" content="https://www.facebook.com/"><meta name="og:site_name" content="Failing Forward | Docker on WSL2"><meta name="og:type" content="website"> <!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Failing Forward | Docker on WSL2"><meta name="twitter:description" content="How to run docker on Win10 using WSL2 and troubleshooting common problems."><meta name="twitter:site" content="@showipintbri"><meta name="twitter:creator" content="@showipintbri"><meta name="twitter:image" content="https://blog.showipintbri.com/assets/images/docker-wsl2.jpg"> <!-- Search Engine --><meta name="description" content="How to run docker on Win10 using WSL2 and troubleshooting common problems."><meta name="image" content="/assets/images/docker-wsl2.jpg"> <!-- Schema.org for Google --><meta itemprop="name" content="Failing Forward | Docker on WSL2"><meta name="author" content="Tony E."/><meta itemprop="description" content="How to run docker on Win10 using WSL2 and troubleshooting common problems."><meta itemprop="image" content="/assets/images/docker-wsl2.jpg"><title>Failing Forward</title><link rel="stylesheet" href="/assets/css/style.css"> <script src="https://kit.fontawesome.com/6a97161b76.js" crossorigin="anonymous"></script><link rel="shortcut icon" href="https://blog.showipintbri.com/assets/images/logo.png" type="image/x-icon"></head></head><body><nav class="navbar is-black is-fixed-top" role="navigation" aria-label="main navigation" id="navbar"><div class="container"> <!-- logo or branding image on left side --><div class="navbar-brand"> <a class="navbar-item" href="https://blog.showipintbri.com/"> <strong>Failing Forward</strong> </a><div class="navbar-burger" data-target="navbar-menu"> <span></span> <span></span> <span></span></div></div><!-- children of navbar-menu must be navbar-start and/or navbar-end --><div class="navbar-menu has-background-black" id="navbar-menu"> <!-- navbar items | left side --> <!--<div class="navbar-start"></div>--> <!-- navbar items | right side --><div class="navbar-end"> <a class="navbar-item " href="https://blog.showipintbri.com/">HOME</a> <a class="navbar-item" href="https://blog.showipintbri.com/#about">ABOUT</a> <a class="navbar-item" href="https://blog.showipintbri.com/#contact">CONTACT</a><div class="navbar-item has-dropdown is-hoverable"> <a class="navbar-link"> BLOG </a><div class="navbar-dropdown has-background-black is-left"> <a href="https://blog.showipintbri.com/blog" class="navbar-item has-text-grey-light "> BLOG POSTS </a> <a href="https://blog.showipintbri.com/tags" class="navbar-item has-text-grey-light "> TAGS </a> <!-- <a href="https://blog.showipintbri.com/categories" class="navbar-item has-text-grey-light "> CATEGORIES </a> <a href="https://blog.showipintbri.com/search" class="navbar-item has-text-grey-light "> SEARCH </a> --></div></div></div></div></div></nav><!-- Bulma Navbar JS --> <script> document.addEventListener('DOMContentLoaded', function () { /* Get all "navbar-burger" elements */ var $navbarBurgers = Array.prototype.slice.call(document.querySelectorAll('.navbar-burger'), 0); /* Check if there are any navbar burgers */ if ($navbarBurgers.length > 0) { /* Add a click event on each of them */ $navbarBurgers.forEach(function ($el) { $el.addEventListener('click', function () { /* Get the target from the "data-target" attribute */ var target = $el.dataset.target; var $target = document.getElementById(target); /* Toggle the class on both the "navbar-burger" and the "navbar-menu" */ $el.classList.toggle('is-active'); $target.classList.toggle('is-active'); }); }); } }); </script><section class="hero is-fullheight has-text-centered" id="post"><div class="hero-body"><div class="container"> <a href="/blog/docker-wsl2" class="has-text-black" id="title"><h1 class="title has-text-centered is-2 has-text-weight-semibold ">Docker on WSL2</h1></a><hr class="has-background-black"><div class="columns is-variable is-5"><div class="column is-6"><figure class="image is-16by9 has-shadow"> <img src="/assets/images/docker-wsl2.jpg" alt="" id="post-image"></figure></div><div class="subtitle column is-5 has-text-left-desktop has-text-left-fullhd has-text-left-tablet has-text-center-mobile"><p id="description" class="content is-small has-text-weight-medium is-uppercase">How to run docker on Win10 using WSL2 and troubleshooting common problems.</p><p class="subtitle is-6 is-uppercase has-text-weight-normal has-text-black-ter">Published on <b>March 01, 2022</b> by <a href="https://twitter.com/showipintbri" target="_blank"><b class="has-text-link"><u>Tony E.</u></b> </a></p><p class="subtitle is-uppercase"> <i class="fas fa-tags"></i> <a href="/blog/tag/docker"><span class="tag is-link">docker</span></a> <a href="/blog/tag/wsl"><span class="tag is-link">WSL</span></a> <a href="/blog/tag/wsl2"><span class="tag is-link">WSL2</span></a></p><p class="subtitle is-uppercase"><i class="fas fa-clock"></i> <b class="has-text-link"> 3 min </b>READ</p></div></div><div class="content has-text-left-desktop has-text-left-fullhd has-text-left has-text-left-tablet has-text-left-mobile"><p><p>For a project I was doing (building a custom VyOS ISO) I wanted to try running a container using Docker in my WSL environment on my laptop. I was told this works and read many examples on how to achieve this.</p><p>While, I do fancy myself as someone who pays close attention to detail, this time I was bested.</p><p>I followed many guides to get docker running in WSL.</p><p>I’m really loving having native linux on my Windows 10 laptop. There’s a small learning curve when needing to troubleshoot if things go wrong.</p><p>Not being a docker expert myself or experienced with Windows Sub-system for Linux (WSL), I was following someone else’s guide. No where was it mentioned about the different versions of WSL or any problems that could cause.</p><p><strong>Exhibit: A</strong></p><p><a href="https://dev.to/felipecrs/simply-run-docker-on-wsl2-3o8">https://dev.to/felipecrs/simply-run-docker-on-wsl2-3o8</a></p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Ensures not older packages are installed:</span>
<span class="nb">sudo </span>apt-get remove docker docker-engine docker.io containerd runc

<span class="nb">sudo </span>apt-get update

<span class="c"># Ensure pre-requisites are installed:</span>
<span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="se">\</span>
    apt-transport-https <span class="se">\</span>
    ca-certificates <span class="se">\</span>
    curl <span class="se">\</span>
    gnupg <span class="se">\</span>
    lsb-release

<span class="c"># Adds docker apt repository:</span>
<span class="nb">echo</span> <span class="se">\</span>
    <span class="s2">"deb [arch=</span><span class="si">$(</span>dpkg <span class="nt">--print-architecture</span><span class="si">)</span><span class="s2"> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu </span><span class="si">$(</span>lsb_release <span class="nt">-cs</span><span class="si">)</span><span class="s2"> stable"</span> |
    <span class="nb">sudo tee</span> /etc/apt/sources.list.d/docker.list <span class="o">&gt;</span> /dev/null

<span class="c"># Adds docker apt key:</span>
curl <span class="nt">-fsSL</span> https://download.docker.com/linux/ubuntu/gpg |
    <span class="nb">sudo </span>gpg <span class="nt">--dearmor</span> <span class="nt">-o</span> /usr/share/keyrings/docker-archive-keyring.gpg

<span class="c"># Refreshes apt repos:</span>
<span class="nb">sudo </span>apt-get update

<span class="c"># Installs Docker CE:</span>
<span class="nb">sudo </span>apt-get <span class="nb">install </span>docker-ce docker-ce-cli containerd.io


<span class="c"># Ensures docker group exists:</span>
<span class="nv">$ </span><span class="nb">sudo </span>groupadd docker

<span class="c"># Ensures you are part of it:</span>
<span class="nv">$ </span><span class="nb">sudo </span>usermod <span class="nt">-aG</span> docker <span class="nv">$USER</span>

<span class="c"># Close your shell and reopen to make sure you're in the correct group (docker):</span>
<span class="nb">groups</span>

<span class="c"># Open ~/.profile and add:</span>
<span class="k">if </span>service docker status 2&gt;&amp;1 | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"is not running"</span><span class="p">;</span> <span class="k">then
    </span>wsl.exe <span class="nt">-d</span> <span class="s2">"</span><span class="k">${</span><span class="nv">WSL_DISTRO_NAME</span><span class="k">}</span><span class="s2">"</span> <span class="nt">-u</span> root <span class="nt">-e</span> /usr/sbin/service docker start <span class="o">&gt;</span>/dev/null 2&gt;&amp;1
<span class="k">fi</span>
</code></pre></div></div><p>Even after manually starting the service (<code class="language-plaintext highlighter-rouge">sudo service docker start</code>), I would run the ‘hello-world’ test and get an error:</p><div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>user@hostname:~<span class="nv">$ </span>docker version

Client: Docker Engine - Community
 Version:           20.10.11
 API version:       1.41
 Go version:        go1.16.9
 Git commit:        dea9396
 Built:             Thu Nov 18 00:37:06 2021
 OS/Arch:           linux/amd64
 Context:           default
 Experimental:      <span class="nb">true

</span>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
</code></pre></div></div><p>The above error along with others was indicating <code class="language-plaintext highlighter-rouge">iptables</code> couldn’t be found. Even when I manually check for iptables, I found it’s not installed! How could this be? Now, were shifting from running and troubleshooting docker to investigation why iptables isn’t included in Ubuntu.</p><p>Turns out, <code class="language-plaintext highlighter-rouge">iptables</code> isn’t included with Ubuntu distro using WSL version 1. Unknowingly, I was using WSL1 not WSL2.</p><p>You can check that in a Windows command prompt:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wsl -l -v
  NAME      STATE           VERSION
* Ubuntu    Running         1
</code></pre></div></div><p>You can set a version number by:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wsl --set-version ubuntu 2
</code></pre></div></div><p>When I did this, I received an error from Microsoft about a “kernel update package” and a hyperlink: <a href="https://docs.microsoft.com/en-us/windows/wsl/install-manual#step-4---download-the-linux-kernel-update-package">https://docs.microsoft.com/en-us/windows/wsl/install-manual#step-4—download-the-linux-kernel-update-package</a></p><p>You’ll need to install the Kernel Update Package as administrator.</p><p>Then, set the version of WSL for your distro:</p><div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wsl --set-version ubuntu 2
</code></pre></div></div><p>It takes a few minutes to convert, but once it does, I was able to open ubuntu and the <code class="language-plaintext highlighter-rouge">iptables</code> command worked perfectly as well as starting the Docker daemon.</p><p>I’ve set my default WSL version to “2” using: <code class="language-plaintext highlighter-rouge">wsl --set-default-version 2</code></p><p>I am now a WSL lover and trying to incorporate it in many of my workflows.</p></p></div></div></div></section><footer id="footer"> <!--Footer Button--><div class="container has-text-centered has-background-grey-darker" id="backtotop"> <a class="has-text-white" onclick="window.scroll(0,0)">BACK TO TOP</a></div><!--Footer Main Section--><div class="has-background-grey-darker"><div class="container columns"> <!--Name Section--><div class="column has-text-left-desktop has-text-centered-mobile"> <a href="https://blog.showipintbri.com/#about"><div class="columns"><div class="column is-one-fifth-desktop is-one-fifth-fullhd is-one-quarter-tablet"><figure class="image is-64x64"> <img class="is-rounded" src="/assets/images/tonye.jpg"></figure></div><div class="column is-marginless"><h5 class="has-text-grey-lighter">Tony E.</h5><div class="content has-text-grey"><p>Tony E. is a network security engineer, CCIE# 64908 & GIAC: Network Fore...</p></div></div></div></a></div><!--Link Section--><div class="column has-text-white"><h3>More Links</h3><!--<li> <a href="https://blog.showipintbri.com/blog/tag/certifications">certifications</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/cisco-asa">cisco asa</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/eve-ng">eve-ng</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/future">future</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/giac">giac</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/goals">goals</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/google-cloud">google cloud</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/gparted">gparted</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/hex">hex</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/internet-access">internet access</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/intrusion-prevention">intrusion prevention</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/ips">ips</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/live">live</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/network-collective">network collective</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/network-field-day">network field day</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/network-forensics">network forensics</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/nfd23">nfd23</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/organization">organization</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/partitions">partitions</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/past">past</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/pcap">pcap</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/present">present</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/sans">sans</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/scapy">scapy</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/scripts">scripts</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/sharkfest">sharkfest</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/stream">stream</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/surface-pro">surface pro</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/suricata">suricata</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/t-i-w-a">t.i.w.a</a></li><li> <a href="https://blog.showipintbri.com/tags">Tags</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/tcp">tcp</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/tcpdump">tcpdump</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/tracewrangler">tracewrangler</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/vyos">vyos</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/wireshark">wireshark</a></li><li> <a href="https://blog.showipintbri.com/blog/tag/zeek">zeek</a></li>--><li> <a target="_blank" href="https://blog.showipintbri.com/feed.xml">Subscribe via RSS</a></li></div><!--Blog-post Section--><div class="column has-text-white"><h3>Recent Posts</h3><li> <a href="https://blog.showipintbri.com/blog/where-to-start">Where To Start Capturing Packets</a></li><li> <a href="https://blog.showipintbri.com/blog/docker-wsl2">Docker on WSL2</a></li><li> <a href="https://blog.showipintbri.com/blog/sharkfest-2021">WiresharkFest 2021 (US)</a></li></div></div></div><div class="has-background-black has-text-centered has-text-white" id="credits"> <i class="far fa-copyright"></i> 2022 | Based on <a href="https://github.com/thedevslot/WhatATheme" target="_blank" rel="noopener noreferrer">WhatATheme</a> Powered by <a href="https://jekyllrb.com/" target="_blank">Jekyll</a></div></footer></body></html>
